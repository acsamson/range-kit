# 核心库

`range-kit` 解决了动态 Web 应用中与文本选择相关的复杂问题。

## 文档
- **[API 参考](./api.md)**：详细的类和方法文档。
- **[架构设计](./architecture.md)**：深入了解定位器 (Locator)、高亮器 (Highlighter) 和交互 (Interaction) 模块。

## 核心功能

### 1. 健壮的选区序列化与恢复
原生 `Range` 对象是临时的，一旦 DOM 发生变化就会失效。`range-kit` 将其转换为持久化的 JSON 格式。

- **多层策略**：使用 4 种策略确保恢复成功：
  1. **ID 锚点**：使用元素 ID 进行快速查找。
  2. **DOM 路径**：类似于 XPath 的结构，用于精确定位。
  3. **文本上下文**：利用周围文本恢复位置，即使 DOM 结构发生变化。
  4. **结构指纹**：针对高度动态内容的模糊匹配。
- **跨会话持久化**：序列化的选区可以存储在数据库中，并在未来的会话中恢复。

### 2. 高性能高亮
传统的 Web 高亮通常通过将文本包裹在 `<span>` 标签中来实现，这可能会破坏 DOM 结构并与 React/Vue 等框架冲突。

- **CSS Custom Highlight API**：在支持的浏览器中使用现代 API (CSS `::highlight`)，实现零 DOM 侵入的高亮。
- **混合降级**：在旧版浏览器中优雅地降级为优化的 DOM 包裹方式。
- **样式隔离**：自定义样式，不污染全局 CSS。

### 3. 高级交互管理
处理高亮文本上的事件（特别是使用 CSS Highlight API 时）非常困难。

- **统一事件**：无论渲染技术如何，都为高亮上的 `click`、`hover` 和 `contextmenu` 事件提供一致的 API。
- **命中测试**：准确检测光标下的高亮。
- **防抖选区**：优化的 `selectionchange` 处理，防止性能瓶颈。

### 4. 重叠检测
检测新选区是否与现有高亮重叠。

- **冲突解决**：识别完全包含、部分重叠或完全匹配。
- **智能合并**：（可选）帮助合并重叠选区的 API。

### 5. 搜索与导航
内置的文本查找和导航功能。

- **搜索高亮**：使用相同的健壮引擎搜索文本并高亮显示所有匹配项。
- **空间导航**：根据文档中的视觉位置在搜索结果间导航（上一项/下一项）。